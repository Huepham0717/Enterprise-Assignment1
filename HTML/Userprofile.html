<!doctype html>
<html lang="en">

<head>
    <title>User profile</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css" />
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>

    <link rel="stylesheet" href="/CSS/Userprofile.css">
</head>
<style>

</style>

<body onload="checkIfLoggedIn()">
    <!-- Optional JavaScript -->
    <!-- jQuery first,
    then Popper.js,
    then Bootstrap JS -->

    <nav class="navbar navbar-expand-md bg-dark navbar-dark">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
        <a class="navbar-brand" href="Home.html"><img src="/Image/Logo/logo.png" alt="logo" style="width: 70%; padding: 0;" /></a>
        <div class="collapse navbar-collapse" style="padding: 0;" id="collapsibleNavbar">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item"><a class="nav-link" href="Home.html">Discover</a></li>

                <li class="dropdown">
                    <a class="nav-link " href="#">Shop</a>
                    <div class="dropdown-content">
                        <a href="Phone.html">Smartphone</a>
                        <a href="Tablet.html">Tablet</a>
                        <a href="Headphones.html">Headphone</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="Contact.html">Contact</a>
                </li>
            </ul>
        </div>

        <div id="myOverlay" class="overlay">
            <span class="closebtn" onclick="closeSearch()" title="Close Overlay">Ã—</span
        >
        <div class="overlay-content">
          <form action="/action_page.php">
            <input type="text" placeholder="Search.." name="search" />
          </form>
        </div>
      </div>
      <button class="openBtn bg-dark" onclick="openSearch()">
        <i class="fa fa-search"></i>
      </button>

      <button class="userBtn bg-dark"><i class="fa fa-user-circle"></i></button>
      <button class="cartBtn bg-dark" id="cart">
        <i class="fa fa-shopping-cart"></i>
      </button>
      <div id="myModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Shopping cart</h5>
                <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <div class="cart-row" style="display:flex">
                <span class="cart-item cart-header cart-column">Product</span>
                <span class="cart-price cart-header cart-column">Price</span>
                <span class="cart-quantity cart-header cart-column">Quantity</span>
            </div>
            <div class="cart-items">

            </div>
            <div class="cart-total">
                <strong class="cart-total-title">Total:</strong>
                <span class="cart-total-price">0 USD</span>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary close-footer">Close</button>
            <button onclick="location.href='FinalCart.html'" type="button" class="btn btn-primary order">Payment</button>
        </div>
        </div>
        </div>
    </nav>
    <div class="wrapper fadeInDown">
        <div id="formContent">
            <!-- Tabs Titles -->
            <form action="#">
                <div class="user-details">
                    <div class="input-box">
                        <label for="" data-placeholder="First name"></label>
                        <input id="firstName" type="text" placeholder="First name" autocomplete="off" data-js="form-text" required>
                    </div>
                    <div class="input-box">
                        <label for="" data-placeholder="Last name"></label>
                        <input id="lastName" type="text" placeholder="Last name" autocomplete="off" data-js="form-text" required>
                    </div>
                    <div class="input-box">
                        <label for="" data-placeholder="User name"></label>
                        <input id="userName" type="text" placeholder="User name" autocomplete="off" data-js="form-text" required>
                    </div>
                    <div class="input-box">
                        <label for="" data-placeholder="Birthday"></label>
                        <input id="birthDay" type="date" placeholder="Birthday" autocomplete="off" data-js="form-text" required>
                    </div>
                    <div class="input-box">
                        <label for="" data-placeholder="Email"></label>
                        <input id="email" type="text" placeholder="Email" autocomplete="off" data-js="form-text" required>
                    </div>
                    <div class="input-box">
                        <label for="" data-placeholder="Phone number"></label>
                        <input id="phoneNumber" type="text" placeholder="Phone number" autocomplete="off" data-js="form-text" required>
                    </div>
                    <div class="input-box">
                        <label for="" data-placeholder="Password"></label>
                        <input id="password" type="password" placeholder="Password" autocomplete="off" data-js="form-text" required>
                    </div>
                    <div class="input-box">
                        <label for="" data-placeholder="Confirm Password"></label>
                        <input id="passwordConfirm" type="password" placeholder="Confirm Password" autocomplete="off" data-js="form-text" required>
                    </div>
                </div>
                <div class="user-details1">
                    <div class="input-box">
                        <label for="" data-placeholder="Address"></label>
                        <input id="address" type="text" placeholder="Address" autocomplete="off" data-js="form-text" required>
                    </div><br>
                </div>

                <div id="formFooter">
                    <a onclick="sendRequest()" class="underlineHover" href="#">Save</a>
                </div>
            </form>
        </div>
    </div>

    <div class="page-footer bg-dark">
        <div class="container text-center text-md-left mt-5">
            <div class="row">
                <div class="col-md-3 mx-auto mb-4">
                    <h6 class="Group_8 text-uppercase font-weight-bold mt-4" style="color: white; display:flex; align-items: center;justify-content: center;"><a style="text-decoration: none; color:white; font-size: 22px;">Group 8</a></h6>
                </div>
                <div class="col-md-2 mx-auto mb-4">
                    <h6 class="heading0 text-uppercase mb-4 mt-0 d-inline-block mx-auto mt-4" style="font-size: 18px; color:White"><a href="Home.html" style="text-decoration: none; color:white;">Discover</a></h6>
                    <hr class="bg-success mb-4 mt-0 d-inline mx-auto" style="width: 85px; height: 2px">
                </div>
                <div class="col-md-2 mx-auto mb-4">
                    <h6 class="Product text-uppercase mb-4 mt-0 d-inline-block mx-auto mt-4" style="font-size: 18px; color:White">Shop</h6>
                    <hr class="bg-success mb-4 mt-0 d-inline mx-auto" style="width: 85px; height: 2px">
                    <ul class="list-unstyled">
                        <li class="Laptop my-2"> <a href="Phone.html" style="Color:White; text-decoration: none;">Smartphone</a></li>
                        <li class="Phones my-2"> <a href="Tablet.html" style="Color:White; text-decoration: none;">Tablet</a></li>
                        <li class="Tablet my-2"> <a href="Headphones.html" style="Color:White; text-decoration: none;">Headphone</a></li>
                    </ul>
                </div>
                <div class="col-md-2 mx-auto mb-4">
                    <h6 class="Product text-uppercase mb-4 mt-0 d-inline-block mx-auto mt-4" style="font-size: 18px; color:White"><a href="Contact.html" style="text-decoration: none; color:white;">Contact</a></h6>
                    <hr class="bg-success mb-4 mt-0 d-inline mx-auto" style="width: 85px; height: 2px">
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    function openSearch() {
        document.getElementById("myOverlay").style.display = "block";
    }

    function closeSearch() {
        document.getElementById("myOverlay").style.display = "none";
    }

    function checkIfLoggedIn() {
        if (sessionStorage.getItem("currentlyLoggedIn") !== "1") {
            alert("You are not signed in. Please sign in first.");
            window.location = '/HTML/Login.html';
        } else {
            loadUser(sessionStorage.getItem("currentUsername"))
        }
    }

    function loadUser(userName) {
        fetch('http://localhost:8080/user/'.concat(userName))
            // fetch('http://localhost:8080/user/billhoang11')
            .then(response => response.json())
            .then(json => {
                console.log(json)
                if (json.message == "Access Denied") {
                    sessionStorage.clear();
                    alert("An error has occured. Please sign in again.");
                    window.location = 'Login.html';
                } else {
                    userId = json.id

                    sessionStorage.setItem("currentUserId", userId)

                    var firstName = json.firstName
                    document.getElementById("firstName").value = firstName;

                    var lastName = json.lastName
                    document.getElementById("lastName").value = lastName;

                    var userName = json.userName
                    document.getElementById("userName").value = userName;

                    var birthDay = json.birthDay
                    document.getElementById("birthDay").value = birthDay;
                    console.log(birthDay)
                    console.log(typeof birthDay)

                    var email = json.email
                    document.getElementById("email").value = email;

                    var phoneNumber = json.phoneNumber
                    document.getElementById("phoneNumber").value = phoneNumber;

                    // var password = json.password
                    // document.getElementById("password").value = password;

                    var address = json.address
                    document.getElementById("address").value = address;
                }
            })
    }

    function sendRequest() {

        var firstName = document.getElementById("firstName").value;
        var lastName = document.getElementById("lastName").value;
        var userName = document.getElementById("userName").value;
        var password = document.getElementById("password").value;
        var passwordConfirm = document.getElementById("passwordConfirm").value;
        var birthDay = document.getElementById("birthDay").value;
        var phoneNumber = document.getElementById("phoneNumber").value;
        var address = document.getElementById("address").value;
        var email = document.getElementById("email").value;

        var requestURL = new URL("http://localhost:8080/user/".concat(sessionStorage.getItem("currentUserId")));

        requestURL.searchParams.append("firstName", firstName);
        requestURL.searchParams.append("lastName", lastName);
        requestURL.searchParams.append("userName", userName);
        requestURL.searchParams.append("password", password);
        requestURL.searchParams.append("phoneNumber", phoneNumber);
        requestURL.searchParams.append("address", address);
        requestURL.searchParams.append("email", email);
        requestURL.searchParams.append("birthDay", birthDay);

        if (password) {
            if (password === passwordConfirm) {
                fetch(requestURL, {
                    method: 'PUT',
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        // document.cookie = "username=".concat(userName);
                        sessionStorage.setItem('currentUsername', userName);
                        alert(data.message);
                        // console.log(requestURL)
                        window.location = 'Userprofile.html';

                    })
                    .catch(err => {
                        console.log(err);
                        console.log(requestURL)
                    })
            }
            else {
                alert("Password Confirmation does not match Password. Please try again.");
            }
        } else {
            alert("Your password cannot be empty. Please try again.");
        }
    }
</script>

</html>